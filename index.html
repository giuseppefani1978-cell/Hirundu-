<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Chasse au tr√©sor du Salento</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: #f4e7c3;
      font-family: Arial, sans-serif;
      overflow: hidden;
    }

    h1 {
      text-align: center;
      padding: 10px;
      font-family: "Treasure Map Deadhand", cursive;
      background: #d19f68;
      border-bottom: 3px solid #000;
    }

    #gameCanvas {
      display: block;
      margin: auto;
      border: 4px solid #000;
      background: #fff;
    }

    #startBtn {
      display: block;
      margin: 20px auto;
      padding: 10px 20px;
      font-size: 20px;
      background: #c98f4a;
      color: #fff;
      border: 2px solid #000;
      cursor: pointer;
    }

    #dialogue {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255, 255, 255, 0.9);
      border: 2px solid #000;
      padding: 10px;
      width: 300px;
      font-size: 16px;
      display: none;
    }

    #controls {
      position: absolute;
      bottom: 30px;
      right: 30px;
      display: none;
    }

    .btn {
      width: 60px;
      height: 60px;
      background: #c98f4a;
      border: 2px solid #000;
      border-radius: 50%;
      margin: 5px;
      font-size: 22px;
      color: white;
      font-weight: bold;
      user-select: none;
    }

    #hud {
      position: absolute;
      top: 10px;
      left: 10px;
      font-size: 20px;
      background: rgba(255,255,255,0.8);
      border: 2px solid #000;
      padding: 5px 10px;
    }
  </style>
</head>
<body>
  <h1>üê¶ Aracne & üï∑ Tarantula - Chasse au tr√©sor du Salento</h1>
  <button id="startBtn">‚ñ∂Ô∏è D√©marrer le jeu</button>
  <div id="hud">‚≠ê 0 / 10</div>
  <div id="dialogue"></div>
  <div id="controls">
    <div style="text-align:center;">
      <button class="btn" id="up">‚¨ÜÔ∏è</button>
    </div>
    <div>
      <button class="btn" id="left">‚¨ÖÔ∏è</button>
      <button class="btn" id="down">‚¨áÔ∏è</button>
      <button class="btn" id="right">‚û°Ô∏è</button>
    </div>
  </div>
  <canvas id="gameCanvas" width="800" height="600"></canvas>

  <script>
    // ----------------------------
    // VARIABLES PRINCIPALES
    // ----------------------------
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    let gameStarted = false;
    let currentStep = 0;
    let starsCollected = 0;

    const mapImg = new Image();
    const aracneImg = new Image();
    const tarantulaImg = new Image();

    mapImg.src = "assets/salento-map.jpg";
    aracneImg.src = "assets/aracne .png";
    tarantulaImg.src = "assets/tarantula .png";

    // Joueur (Aracne l‚Äôhirondelle)
    const player = { 
      x: 100, 
      y: 100, 
      size: 40, 
      speed: 5 
    };

    // Liste des 10 √©tapes avec coordonn√©es
    const steps = [
      { x: 650, y: 120, texte: "Bienvenue √† Otranto et sa cath√©drale !" },
      { x: 670, y: 180, texte: "Porto Badisco, c√©l√®bre calanque." },
      { x: 640, y: 220, texte: "Santa Cesarea Terme et ses thermes." },
      { x: 600, y: 260, texte: "Castro et la l√©gende du temple d‚ÄôAth√©na." },
      { x: 570, y: 300, texte: "La calanque Il Ciolo et son pont." },
      { x: 530, y: 350, texte: "Santa Maria di Leuca et son phare." },
      { x: 300, y: 300, texte: "Gallipoli, la perle ionienne." },
      { x: 200, y: 250, texte: "Porto Cesareo et ses plages." },
      { x: 250, y: 200, texte: "La ville baroque de Nard√≤." },
      { x: 400, y: 150, texte: "Lecce, la Florence du Sud." }
    ];

    const dialogueBox = document.getElementById("dialogue");
    const hud = document.getElementById("hud");

    // ----------------------------
    // AFFICHAGE DU DIALOGUE
    // ----------------------------
    function showDialogue(text) {
      dialogueBox.innerText = "üï∑ Tarantula : " + text;
      dialogueBox.style.display = "block";
      setTimeout(() => { dialogueBox.style.display = "none"; }, 4000);
    }

    // ----------------------------
    // DEMARRAGE DU JEU
    // ----------------------------
    function startGame() {
      gameStarted = true;
      document.getElementById("startBtn").style.display = "none";
      document.getElementById("controls").style.display = "block";
      loop();
    }

    // ----------------------------
    // BOUCLE PRINCIPALE
    // ----------------------------
    function loop() {
      if (!gameStarted) return;

      ctx.clearRect(0,0,canvas.width,canvas.height);

      // Carte
      ctx.drawImage(mapImg, 0, 0, canvas.width, canvas.height);

      // Dessiner le chemin en pointill√©s
      drawTreasurePath();

      // √âtoiles collect√©es (HUD)
      hud.innerText = "‚≠ê " + starsCollected + " / 10";

      // Dessiner toutes les √©tapes d√©j√† visit√©es
      for (let i = 0; i < steps.length; i++) {
        ctx.beginPath();
        if (i < currentStep) {
          ctx.fillStyle = "gold"; // √âtoile collect√©e
        } else {
          ctx.fillStyle = "red"; // Prochaine √©tape
        }
        ctx.arc(steps[i].x, steps[i].y, 10, 0, Math.PI*2);
        ctx.fill();
        ctx.closePath();
      }

      // Joueur
      ctx.drawImage(aracneImg, player.x, player.y, player.size, player.size);

      requestAnimationFrame(loop);
      checkCollision();
    }

    // ----------------------------
    // CHEMIN EN POINTILL√âS
    // ----------------------------
    function drawTreasurePath() {
      ctx.strokeStyle = "#000";
      ctx.setLineDash([10, 10]);
      ctx.beginPath();
      ctx.moveTo(steps[0].x, steps[0].y);
      for (let i = 1; i < steps.length; i++) {
        ctx.lineTo(steps[i].x, steps[i].y);
      }
      ctx.stroke();
      ctx.setLineDash([]);
    }

    // ----------------------------
    // COLLISIONS
    // ----------------------------
    function checkCollision() {
      if (currentStep >= steps.length) return;
      const step = steps[currentStep];
      const dx = player.x - step.x;
      const dy = player.y - step.y;
      const dist = Math.sqrt(dx*dx + dy*dy);
      if (dist < 20) {
        starsCollected++;
        showDialogue(step.texte);
        currentStep++;
        if (currentStep >= steps.length) {
          setTimeout(() => {
            alert("üéâ Bravo ! Tu as d√©couvert tous les secrets du Salento !");
          }, 1000);
        }
      }
    }

    // ----------------------------
    // MOUVEMENT
    // ----------------------------
    function move(dx,dy) {
      player.x += dx * player.speed;
      player.y += dy * player.speed;
    }

    // ----------------------------
    // CONTROLES TACTILES
    // ----------------------------
    document.getElementById("up").addEventListener("touchstart", () => move(0,-1));
    document.getElementById("down").addEventListener("touchstart", () => move(0,1));
    document.getElementById("left").addEventListener("touchstart", () => move(-1,0));
    document.getElementById("right").addEventListener("touchstart", () => move(1,0));

    // Bouton d√©marrage
    document.getElementById("startBtn").addEventListener("click", startGame);
  </script>
</body>
</html>
